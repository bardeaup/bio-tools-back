package com.biotools.mapper;

import java.math.BigDecimal;
import java.util.List;

import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.Mappings;

import com.biotools.dto.CellCountDTO;
import com.biotools.dto.CellularCountProjectDTO;
import com.biotools.dto.ConditionDTO;
import com.biotools.dto.DetailDTO;
import com.biotools.dto.TreatmentDTO;
import com.biotools.entity.CellularCount;
import com.biotools.entity.Condition;
import com.biotools.entity.Detail;
import com.biotools.entity.Experiment;
import com.biotools.entity.Treatment;

@Mapper(componentModel = "spring")
public interface ExperimentMapperMapstruct {
	
	@Mapping(target="conditions", source="conditionList")
	Experiment cellularCountProjectDTOToProliferationExperimentEntity(
			CellularCountProjectDTO cellularCountProjectDTO);
		
	List<Condition> ConditionDTOListToEntity (List<ConditionDTO> conditionDTOList);
	
	@Mapping(target="cellularCountList", source="cellCountList")
	Condition ConditionDTOToEntity(ConditionDTO conditionDTO);

	List<CellularCount> cellCountDTOListToEntity (List<CellCountDTO> cellCountDTOList);
	@Mappings({
		@Mapping(target="pd", source="populationDoubling"),
		@Mapping(target="dt", source="doublingTime"),
	})
	CellularCount cellCountDTOToEntity (CellCountDTO cellCountDTO);
	
	List<Treatment> treatmentDTOListToEntity (List<TreatmentDTO> treatmentDTOList);
	
	Treatment treatmentDTOToEntity (TreatmentDTO treatmentDTO);

	// --------- Mapping inverse --------------------
	

	List<CellularCountProjectDTO> proliferationExperimentEntityListToDto(
			List<Experiment> experimentList);
	
	@Mapping(target="conditionList", source="conditions")
	CellularCountProjectDTO proliferationExperimentEntityToDto(
			Experiment experiment);
	
	DetailDTO detailEntityToDto(Detail detail);
		
	List<ConditionDTO> ConditionEntityListToDto (List<Condition> conditionList);
	
//	@Mapping(target="cellCountList", source="cellularCountList", ignore = true)
//	ConditionDTO conditionEntityToDto(Condition condition);
	
	default ConditionDTO conditionEntityToDto(Condition condition) {
        ConditionDTO c = new ConditionDTO();
        c.setId(condition.getId());
        c.setCellLine(condition.getCellLine());
        c.setInitialPopulationDoubling(new BigDecimal(condition.getInitialPopulationDoubling()));
        c.setTreatmentList(this.treatmentEntityListToDto(condition.getTreatmentList()));
        c.setFirstSeeding(condition.getCellularCountList() == null || condition.getCellularCountList().isEmpty());
        c.setCellCountList(this.cellCountEntityListToDto(condition.getCellularCountList()));
        return c;
    }
	
	List<CellCountDTO> cellCountEntityListToDto (List<CellularCount> cellCountEntityList);
	
	@Mappings({
	      @Mapping(target="populationDoubling", source="pd"),
	      @Mapping(target="doublingTime", source="dt")
	    })
	CellCountDTO cellCountEntityToDto (CellularCount cellCountEntity);
	
	List<TreatmentDTO> treatmentEntityListToDto (List<Treatment> treatmentEntityList);
	
	@Mappings({
	      @Mapping(target="concentrationUnitId", source="unit.id"),
	      @Mapping(target="concentrationUnitLabel", source="unit.unitLabel")
	      })
	TreatmentDTO treatmentEntityToDto (Treatment treatmentEntity);
	
	
}
